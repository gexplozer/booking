let getStorage=JSON.parse(readStorage());const now=new Date;let pickedDay,today=now.getDate()+1,year=now.getFullYear(),month=now.getMonth(),monthLength=33-new Date(now.getFullYear(),now.getMonth(),33).getDate(),monthStartDay=new Date(now.getFullYear(),now.getMonth(),1).getDay(),storage=[],workingTimes=["9:00","9:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30"];function scanBookingTimes(e){let t=qS(".times");t.innerHTML="",workingTimes.forEach(function(t){let n=document.createElement("span"),a=parseInt(t.replace(/\D+/g,""));getStorage[year][month][e]&&getStorage[year][month][e][a]||(n.innerHTML=t,qS(".times").appendChild(n))}),t.firstChild.classList.add("picked"),qS("#selectedTime").innerHTML=t.firstChild.innerHTML;let n=qSA(".times span:not(.disabled)");[].forEach.call(n,function(e){e.addEventListener("click",function(){qS(".time .picked")&&qS(".time .picked").classList.remove("picked"),this.classList.add("picked"),qS("#selectedTime").innerHTML=this.innerHTML})})}function readStorage(){let e=new XMLHttpRequest;return e.open("GET","/booking.json",!1),e.onload=function(){"200"==e.status&&(file=e.responseText)},e.send(),file||""}function writeStorage(){let e={year:parseInt(qS("#selectedYear").innerHTML),month:parseInt(qS("#selectedMonth").innerHTML),day:parseInt(qS("#selectedDate").innerHTML),time:parseInt(qS("#selectedTime").innerHTML.replace(/\D+/g,""))},t=new XMLHttpRequest;t.open("POST","http://server.lime82.ru/booking.php"),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send("data="+JSON.stringify(e)),t.onreadystatechange=function(){4==t.readyState&&("ЗАНЯТО"==t.responseText?console.log("БЛЯ(("):console.log(t.responseText))}}function insertCta(e,t){qS(".ctaTingle form .ctaRequest").value=`${e} | ${t}`,qS(".ctaTingle form h3").innerHTML=e;let n=qSA(".selected div div")[0].cloneNode(!0),a=qSA(".selected div div")[1].cloneNode(!0);qS(".ctaTingle form div").appendChild(n),qS(".ctaTingle form div").appendChild(a),qS(".ctaTingle form button").innerHTML=t}for(let e=1;e<monthLength+1;e++){let t=document.createElement("span"),n=new Date(year,month,e),a=0==n.getDay()||6==n.getDay();a&&t.classList.add("weekend"),e<today&&t.classList.add("disabled"),e!=today||a||(t.classList.add("picked"),qS("#selectedDate").innerHTML=`${e}/`),e>today&&!a&&!qS(".calendar .picked")&&(t.classList.add("picked"),qS("#selectedDate").innerHTML=`${e}/`),t.innerHTML=e,qS(".calendar").appendChild(t)}qS(".calendar span:first-child").style.marginLeft=100/7*(monthStartDay-1)+"%",scanBookingTimes(today);let dates=qSA(".calendar span:not(.disabled):not(.weekend)");[].forEach.call(dates,function(e){e.addEventListener("click",function(){pickedDay=parseInt(this.innerHTML),qS(".calendar .picked").classList.remove("picked"),this.classList.add("picked"),qS("#selectedDate").innerHTML=`${this.innerHTML}/`,scanBookingTimes(pickedDay)})});let modalCta=new tingle.modal({cssClass:["ctaTingle"],onOpen:function(){common.formsListener(".tingle-modal .leadData")}});qS("#addBooking").addEventListener("click",()=>{modalCta.setContent(qS(".inlineCtaBlock").innerHTML),insertCta("Почти готово! Введите контакты:","Записаться"),modalCta.open()});let common=sendData(modalCta);common.callback=function(){writeStorage(),qS(".openButton").click()};